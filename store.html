<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Store — StoresNearm</title>

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: #ffffff;
  color: #111;
  padding: 20px;

  opacity: 0;
  transition: opacity 0.4s ease;
}

body.loaded { opacity: 1; }
body.fade-out { opacity: 0; }

.back {
  background: none;
  border: none;
  font-size: 16px;
  cursor: pointer;
  margin-bottom: 15px;
}

.store-image {
  width: 100%;
  border-radius: 14px;
  margin-bottom: 15px;
}

.store-name {
  font-size: 22px;
  font-weight: 600;
  margin-bottom: 6px;
}

.store-summary {
  font-size: 14px;
  color: #555;
  margin-bottom: 15px;
}

.store-info {
  font-size: 14px;
  margin-bottom: 6px;
}

.store-info a {
  color: black;
  text-decoration: underline;
}

.section-title {
  margin-top: 25px;
  font-weight: 600;
  margin-bottom: 10px;
}

input, textarea {
  width: 100%;
  padding: 12px;
  margin-bottom: 10px;
  border-radius: 10px;
  border: 1px solid #ddd;
  font-size: 14px;
}

button.apply-btn {
  width: 100%;
  padding: 14px;
  border-radius: 12px;
  border: none;
  background: black;
  color: white;
  font-size: 15px;
  cursor: pointer;
}

button.whatsapp-btn {
  width: 100%;
  padding: 12px;
  border-radius: 12px;
  border: none;
  background: #25D366;
  color: white;
  font-size: 14px;
  cursor: pointer;
  margin-top: 10px;
}
</style>
</head>

<body>

<button class="back" onclick="goBack()">← Back</button>

<div id="storeContent"></div>

<script>

/* Fade in */
window.onload = function () {
  document.body.classList.add("loaded");
};

/* Prevent white screen */
window.addEventListener("pageshow", function () {
  document.body.classList.remove("fade-out");
  document.body.classList.add("loaded");
});

/* Back button */
function goBack() {
  document.body.classList.remove("loaded");
  document.body.classList.add("fade-out");

  setTimeout(function () {
    window.location.href = "listings.html";
  }, 400);
}

/* Get selected store */
const storeData = localStorage.getItem("selectedStore");

if (!storeData) {
  window.location.href = "location.html";
}

const store = JSON.parse(storeData);

const container = document.getElementById("storeContent");

/* WhatsApp Button */
let whatsappButton = "";
if (store.whatsapp) {
  whatsappButton = `
    <button class="whatsapp-btn"
      onclick="window.open('https://wa.me/${store.whatsapp}?text=Hello%20${encodeURIComponent(store.name)}%20I%20am%20interested%20in%20applying','_blank')">
      Message on WhatsApp
    </button>
  `;
}

container.innerHTML = `
  <img class="store-image" src="${store.image}" alt="${store.name}">
  <div class="store-name">${store.name}</div>
  <div class="store-summary">${store.summary}</div>

  <div class="store-info"><strong>Phone:</strong>
    <a href="tel:${store.phone.replace(/\s+/g,'')}">${store.phone}</a>
  </div>

  <div class="store-info"><strong>Email:</strong>
    <a href="mailto:${store.email}">${store.email}</a>
  </div>

  <div class="store-info"><strong>Website:</strong>
    <a href="${store.website}" target="_blank">${store.website}</a>
  </div>

  ${whatsappButton}

  <div class="section-title">Apply to this Store</div>

  <input type="text" id="name" placeholder="Your Full Name" required>
  <input type="email" id="email" placeholder="Your Email Address" required>
  <textarea id="message" rows="4" placeholder="Short message to the store"></textarea>

  <button class="apply-btn" onclick="applyNow()">Send Application</button>
`;

/* Apply function */
function applyNow() {

  const name = document.getElementById("name").value;
  const email = document.getElementById("email").value;
  const message = document.getElementById("message").value;

  if (!name || !email) {
    alert("Please fill in required fields.");
    return;
  }

  const subject = encodeURIComponent("Job Application - " + store.name);
  const body = encodeURIComponent(
    "Hello " + store.name + ",\n\n" +
    "My name is " + name + ".\n" +
    "My email is " + email + ".\n\n" +
    message + "\n\nRegards,\n" + name
  );

  window.location.href = `mailto:${store.email}?subject=${subject}&body=${body}`;
}

</script>

</body>
</html>
